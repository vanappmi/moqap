.template release-version:
  script:
    - |
      echo "get release version for au and prod from ops repo..."
      eval $(ssh-agent -s)
      ssh-add <(echo "$SSH_PRIVATE_KEY" | base64 -d)
      ssh-add -l
      ssh -T -o StrictHostKeyChecking=no git@ssh.git.tech.rz.db.de
      git clone git@ssh.git.tech.rz.db.de:cnp/bbpneo/bbpneo-ops.git
      # AU
      cd bbpneo-ops/bbpneo-iat/deployment/
      export DEPLOY_TEMPLATE="${CI_PROJECT_NAME}/${CI_PROJECT_NAME}.yaml"
      export RELEASE_VERSION_AU=$(yq '(.spec.generators.0.matrix.generators.0.list.elements.[] | select(.environment == "au") .releaseVersion)' $DEPLOY_TEMPLATE)
      # PROD
      cd ../../../bbpneo-ops/bbpneo-prod/deployment
      export DEPLOY_TEMPLATE="${CI_PROJECT_NAME}/${CI_PROJECT_NAME}-prod.yaml"
      export RELEASE_VERSION_PROD=$(yq '.spec.source.helm.values' | grep 'releaseVersion' $DEPLOY_TEMPLATE | cut -d ":" -f2 | tr -dc '0-9.')'
