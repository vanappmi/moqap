---
.job_template: &job_template
  tags:
    - $PROJECT_RUNNER_TAG

Build Image STAGE:
  extends: .kaniko-build
  dependencies:
    - Build Go
  needs:
    - job: Build Go
  stage: build-go-image
  <<: *job_template
  environment:
    name: ${DEPLOY_ENV}
  artifacts:
    paths:
      - artifacts/*
  variables:
    KANIKO_IMAGE_NAME: $CI_PROJECT_NAME
    KANIKO_SOURCE_REPO: ${PROD_DOCKER_REPO}
    SECRETS:
      CI_REGISTRY_USER:RUNNER_ARTIFACTORY_USER,
      CI_REGISTRY_PASSWORD:RUNNER_ARTIFACTORY_PASSWORD
