---
.job_template: &job_template
  tags:
    - $PROJECT_RUNNER_TAG

Build Go:
  stage: build-go
  <<: *job_template
  image: ${PROD_DOCKER_REPO}.bahnhub.tech.rz.db.de/golang:golang-1.23.4
  script:
    - export PATH=$PATH:/usr/local/go/bin
    - echo $PATH
    - go version
    - echo "Clean cache"
    - go clean -cache
    - go clean -modcache
    - echo "Update all Go Modlues"
    - go get -u -t all
    - go mod tidy
    - echo "build executable"
    - echo $BUILD_CMD
    - GOARCH=amd64 GOOS=linux go build $BUILD_CMD
    - mkdir -p ./artifacts/
    - cp postgres_exporter ./artifacts/
  artifacts:
    paths:
      - artifacts/*
