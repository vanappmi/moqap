---
.job_template: &job_template
  tags:
    - $PROJECT_RUNNER_TAG

Build Go:
  stage: build-go
  <<: *job_template
  image: ${PROD_DOCKER_REPO}.bahnhub.tech.rz.db.de/golang:golang-1.24.1
  script:
    - export PATH=$PATH:/usr/local/go/bin
    - export GOPATH=/tmp
    - echo $PATH
    - echo $GOPATH
    - go version
    - go env
    - echo "Clean cache"
    - go clean -cache
    - go clean -modcache
    - |
      if [ $IS_UPDATE == "true" ];
      then
        echo "Update all Go Modules"
        go get -u -t all
      fi
    - go mod tidy
    - echo "build executable"
    - mkdir -p build
    - mkdir -p artifacts
    - echo $BUILD_CMD
    #- GOARCH=amd64 GOOS=linux go build -o artifacts/app $BUILD_CMD
    - make origin-build
    - ls -al /tmp/bin
    - cp /tmp/bin/* artifacts
  artifacts:
    paths:
      - artifacts/*
