---
.job_template: &job_template
  tags:
    - $PROJECT_RUNNER_TAG

Build Image STAGE:
  extends: .kaniko-build
  dependencies:
    - Build Jar
  needs:
    - job: Build Jar
  stage: build-image
  <<: *job_template
  environment:
    name: ${DEPLOY_ENV}
  artifacts:
    paths:
      - artifacts/*
  variables:
    KANIKO_IMAGE_NAME: $PROJECT_NAME
    SECRETS:
      CI_REGISTRY_USER:RUNNER_ARTIFACTORY_USER,
      CI_REGISTRY_PASSWORD:RUNNER_ARTIFACTORY_PASSWORD
#  rules:
#    - if: $TRIGGER_BUILD_MANUALLY == "true"
#      when: manual
#      allow_failure: true
#    - if: $TRIGGER_BUILD_MANUALLY == "false"
#      when: always
