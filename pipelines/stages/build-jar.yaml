---
Build Jar:
  stage: build-jar
  tags:
    - eks-dev
  image: cna-3bservices-dev-docker-stage-local.bahnhub.tech.rz.db.de/basis-pipeline-image:java-19
  dependencies:
    - lint_dockerfile
    - SonarQube
    - Whitesource
#    - scan_secrets #comment in after secrets removal
  needs:
    - job: lint_dockerfile
    - job: SonarQube
    - job: Whitesource
#    - job: scan_secrets #comment in after secrets removal
  rules:
    - if: $CI_COMMIT_BRANCH != $CI_DEFAULT_BRANCH
      when: always
    - if: $BUILD_DISABLE == "true"
      when: never
  script:
    - export GRADLE_OPTS="$GRADLE_OPTS_OWN"
    - echo $GRADLE_OPTS
    - gradle clean build jacocoTestCoverageVerification bootJar
    - mkdir -p ./artifacts/
    - cp build/libs/*.jar ./artifacts/
  artifacts:
    paths:
      - artifacts/*
      - .gradle/
  variables:
    GRADLE_OPTS_OWN: "-Dhttps.proxyHost=webproxy.comp.db.de -Dhttps.proxyPort=8080 -Dhttp.nonProxyHosts=*.tech.rz.db.de|*.dbcs.db.de|*.amazonaws.com|*.aws.db.de|*.cluster.local|*.internal|*.intranet-test.deutschebahn.com|*.intranet.deutschebahn.com|*.mail.db.de|*.ose.db.de|*.rz.db.de|*.svc|*.unix.db.de|127.0.0.1|dbcs-Maste-C6UND8OK4HFR-3e69d5b84ddd5126.elb.eu-central-1.amazonaws.com|ip-10-107-227-150.eu-central-1.compute.internal|localhost|*.comp.db.de"

